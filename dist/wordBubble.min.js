function WordBubble(){function a(a){_.defaults(a,{fill:"white",strokeWidth:10,strokeColor:"black",depth:10,font:"Helvetica",fontSize:30,width:800,baselineShift:0});var c,d=+a.depth,e=+a.strokeWidth,f=+a.baselineShift,g=document.createElement("canvas"),h=g.getContext("2d"),i=a.fontSize+"pt "+a.font;h.font=i;var j=b(h,a.text,a.width-2*e-10),k=j.lines;g.width=a.width;var l=+a.lineHeight||+a.fontSize+ +e;g.height=l*k.length+2*+e+20+d;var m=(g.width-j.widest)/2;a.fill.colors?(c=h.createLinearGradient(m,.1*g.height,g.width-m,.9*g.height),a.fill.colors.forEach(function(a){c.addColorStop(a.stop,a.color)})):c=a.fill.color||a.fill;var n=e/2+d+10+f,o=a.width/2,p=0;for(h.font=i,h.globalAlpha=1,h.globalCompositeOperation="source-over",h.fillStyle=a.strokeColor,h.textAlign="center",h.textBaseline="top",h.lineWidth=2*e,h.lineJoin="round",h.strokeStyle=a.strokeColor,p=0;d>p;p++)k.forEach(function(a,b){var c=l*b;h.fillText(a,o,c+n-p+e),h.strokeText(a,o,c+n-p+e)});return h.fillStyle=c,k.forEach(function(a,b){var c=l*b;h.globalAlpha=1,h.globalCompositeOperation="source-over",h.fillText(a,o,c+n-p+e),h.globalAlpha=.75,h.lineWidth=2,h.strokeStyle="white",h.globalCompositeOperation="soft-light",h.strokeText(a,o,c+n-p+e)}),g.className="word-bubble",a.animation&&g.classList.add(a.animation),g}function b(a,b,c){for(var d=b.split("\n"),e=[],f=0,g=0;g<d.length;g++){for(var h=d[g].split(" "),i="",j=0;j<h.length;j++){var k=i+h[j]+" ",l=a.measureText(k.trim()),m=l.width;m>c&&j>0?(e.push(i.trim()),i=h[j]+" "):(i=k,f=Math.max(f,m))}e.push(i.trim())}return{lines:e,widest:f}}this.pop=function(b,c,d){d&&c&&c.querySelector&&Array.prototype.forEach.call(c.querySelectorAll("canvas.word-bubble"),function(a){c.removeChild(a)}),[].concat(b).map(function(b){return a(b)}).forEach(function(a){c&&c.querySelector&&(c.appendChild(a),a.offsetWidth,a.classList.add("enter"))})}}